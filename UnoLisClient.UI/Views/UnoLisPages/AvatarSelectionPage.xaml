<Page x:Class="UnoLisClient.UI.Views.UnoLisPages.AvatarSelectionPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:language="clr-namespace:UnoLisClient.UI.Properties.Langs"
      mc:Ignorable="d"
      xmlns:vms="clr-namespace:UnoLisClient.UI.ViewModels.ViewModelEntities"
      xmlns:converters="clr-namespace:UnoLisClient.UI.Converters"
      Title="AvatarSelectionPage"
      Loaded="AvatarSelectionPageLoaded">
    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="InvertedBoolToVisibilityConverter" TrueValue="Collapsed" FalseValue="Visible" />
        <converters:BoolToThicknessConverter x:Key="SelectionBorderConverter" TrueThickness="3" FalseThickness="1" />

        <DataTemplate x:Key="AvatarItemTemplate" DataType="{x:Type vms:AvatarModel}">
            <StackPanel HorizontalAlignment="Center">
                <Border Width="100" Height="100" CornerRadius="10" 
                        Background="#33FFFFFF"
                        ToolTip="{Binding Description}"
                        BorderBrush="{Binding RarityBrush}"
                        BorderThickness="{Binding IsSelected, Converter={StaticResource SelectionBorderConverter}}">

                    <Border.InputBindings>
                        <MouseBinding MouseAction="LeftClick" 
                              Command="{Binding DataContext.SelectAvatarCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}}}"
                              CommandParameter="{Binding}"/>
                    </Border.InputBindings>

                    <Grid>
                        <Border CornerRadius="8">
                            <Border.Background>
                                <ImageBrush ImageSource="{Binding ImagePath}" Stretch="UniformToFill"/>
                            </Border.Background>
                        </Border>

                        <Border Background="#AA000000"
                                Visibility="{Binding IsUnlocked, Converter={StaticResource InvertedBoolToVisibilityConverter}}"
                                IsHitTestVisible="False"
                                CornerRadius="8"/>

                        <Image Source="/Assets/Other/Locked.png" 
                               Stretch="Uniform"
                               Width="60" Height="60"
                               HorizontalAlignment="Center" VerticalAlignment="Center"
                               Visibility="{Binding IsUnlocked, Converter={StaticResource InvertedBoolToVisibilityConverter}}"
                               IsHitTestVisible="False"/>
                    </Grid>
                </Border>

                <TextBlock Text="{Binding Name}"
                           Foreground="White" FontSize="14"
                           HorizontalAlignment="Center" Margin="0,6,0,0"/>
            </StackPanel>
        </DataTemplate>

        <ItemsPanelTemplate x:Key="AvatarItemsPanel">
            <UniformGrid Columns="4" Margin="0,0,0,25" />
        </ItemsPanelTemplate>
    </Page.Resources>

    <Border Background="#AA000000"
        CornerRadius="15"
        Padding="24"
        MinWidth="350" MinHeight="300"
        HorizontalAlignment="Center"
        VerticalAlignment="Center">
        <Grid Background="Transparent">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0"
                   Text="{x:Static language:Profile.ChangeAvatarLabel}"
                   FontSize="36"
                   FontWeight="Bold"
                   Foreground="White"
                   FontFamily="pack://application:,,,/Fonts/#Luckiest Guy"
                   Margin="0,10,0,30"
                   HorizontalAlignment="Left"/>

            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <StackPanel Orientation="Vertical" Margin="0,0,0,20">

                    <TextBlock Text="{x:Static language:Profile.CommonSkinsLabel}"
                           FontSize="22"
                           FontWeight="SemiBold"
                           Foreground="White"
                           FontFamily="pack://application:,,,/Fonts/#Luckiest Guy"
                           Margin="0,0,0,10"/>
                    <ListBox ItemsSource="{Binding CommonAvatars}"
                         SelectedItem="{Binding SelectedAvatar, Mode=TwoWay}"
                         ItemTemplate="{StaticResource AvatarItemTemplate}"
                         ItemsPanel="{StaticResource AvatarItemsPanel}"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
                    <TextBlock Text="{x:Static language:Profile.SpecialSkinsLabel}"
                           FontSize="22"
                           FontWeight="SemiBold"
                           Foreground="White"
                           FontFamily="pack://application:,,,/Fonts/#Luckiest Guy"
                           Margin="0,10,0,10"/>
                    <ListBox ItemsSource="{Binding SpecialAvatars}"
                         SelectedItem="{Binding SelectedAvatar, Mode=TwoWay}"
                         ItemTemplate="{StaticResource AvatarItemTemplate}"
                         ItemsPanel="{StaticResource AvatarItemsPanel}"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
                    <TextBlock Text="{x:Static language:Profile.EpicSkinsLabel}"
                           FontSize="22"
                           FontWeight="SemiBold"
                           Foreground="White"
                           FontFamily="pack://application:,,,/Fonts/#Luckiest Guy"
                           Margin="0,10,0,10"/>
                    <ListBox ItemsSource="{Binding EpicAvatars}"
                         SelectedItem="{Binding SelectedAvatar, Mode=TwoWay}"
                         ItemTemplate="{StaticResource AvatarItemTemplate}"
                         ItemsPanel="{StaticResource AvatarItemsPanel}"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
                    <TextBlock Text="{x:Static language:Profile.LegendarySkinsLabel}"
                           FontSize="22"
                           FontWeight="SemiBold"
                           Foreground="White"
                           FontFamily="pack://application:,,,/Fonts/#Luckiest Guy"
                           Margin="0,10,0,10"/>
                    <ListBox ItemsSource="{Binding LegendaryAvatars}"
                         SelectedItem="{Binding SelectedAvatar, Mode=TwoWay}"
                         ItemTemplate="{StaticResource AvatarItemTemplate}"
                         ItemsPanel="{StaticResource AvatarItemsPanel}"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
                </StackPanel>
            </ScrollViewer>

            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="{x:Static language:Global.SaveButton}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    Width="116"
                    Height="40"
                    Margin="0,0,10,0"
                    Command="{Binding SaveCommand}"/>
                <Button Content="{x:Static language:Global.CancelButton}"
                    Style="{StaticResource SecondaryButtonStyle}"
                    Width="115"
                    Height="40"
                    Command="{Binding CancelCommand}"/>
            </StackPanel>
        </Grid>
    </Border>
</Page>
